<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title>ZooKeeper Admin</title>
    <meta name="description" content="overview &amp; stats"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="shortcut icon" href="../assets/images/system/favicon.ico"/>
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../assets/font-awesome/4.5.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="../assets/css/common.css"/>
    <script src="../assets/js/base/jquery-2.1.3.js"></script>
    <script src="../assets/js/base/jquery.cookie.min.js"></script>
    <script src="../assets/js/base/bootstrap.min.js"></script>
    <!-- sco -->
    <link rel="stylesheet" href="../assets/js/plugins/scojs/css/sco.message.css"/>
    <link rel="stylesheet" href="../assets/js/plugins/ladda/ladda-themeless.min.css">
    <script src="../assets/js/plugins/scojs/js/sco.message.js"></script>
    <script src="../assets/js/plugins/scojs/js/sco.confirm.js"></script>
    <script src="../assets/js/plugins/scojs/js/sco.modal.js"></script>
    <!-- ladda -->
    <script src="../assets/js/plugins/ladda/spin.min.js"></script>
    <script src="../assets/js/plugins/ladda/ladda.min.js"></script>
    <!-- chosen -->
    <link rel="stylesheet" href="../assets/css/chosen.min.css"/>
    <script src="../assets/js/base/chosen.jquery.min.js"></script>

    <!-- common -->
    <script src="../assets/common/utils.js"></script>
    <link rel="stylesheet" href="../assets/common/common.css"/>
    <script src="../assets/common/common.js"></script>

    <!-- echart -->
    <script src="../assets/js/plugins/echarts/echarts3.3.3.js"></script>

    <!-- vue -->
    <script src="../assets/js/plugins/vue/vue.js"></script>


    <script src="scripts/manager_cluster_machines.js"></script>

    <!-- ace -->
    <link rel="stylesheet" href="../assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style"/>
    <script src="../assets/js/base/ace-extra.min.js"></script>
    <script src="../assets/js/base/ace-elements.min.js"></script>
    <script src="../assets/js/base/ace.min.js"></script>
    <!--<style>-->
        <!--.nav-tabs>li>a, .nav-tabs>li>a:focus {-->
            <!--cursor: pointer;-->
            <!--border-bottom: 0px !important;-->
        <!--}-->
    <!--</style>-->
</head>

<body class="no-skin">
<div id="navbar" class="navbar navbar-default ace-save-state navbar-fixed-top">
    <div class="navbar-container ace-save-state" id="navbar-container">
        <button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler" data-target="#sidebar">
            <span class="sr-only">Toggle sidebar</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <div class="navbar-header pull-left">
            <a href="index.html" class="navbar-brand">
                <small>
                    <i class="fa fa-leaf" style="color: #5df910!important"></i>
                    <b>ZooKeeper Admin</b>
                </small>
            </a>
        </div>
        <div class="navbar-buttons navbar-header pull-right" role="navigation">
            <ul class="nav ace-nav">
                <li class="light-blue dropdown-modal">
                    <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                        <img class="nav-user-photo" src="../assets/images/system/user.jpg" alt="Jason's Photo"/>
                        <span class="user-info">
                            您好, <span id="loginUname"></span>
                        </span>
                        <i class="ace-icon fa fa-caret-down"></i>
                    </a>
                    <ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                        <li>
                            <a href="#" id="exitSystemB">
                                <i class="ace-icon fa fa-power-off"></i> 登出
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <!-- /.navbar-container -->
</div>
<div class="main-container ace-save-state" id="main-container">
    <div id="sidebar" class="sidebar responsive sidebar-fixed sidebar-scroll">
        <ul class="nav nav-list" style="transition-property: top; transition-duration: 0.15s;">
            <li class="active open">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-sitemap"></i>
                    <span class="menu-text">
                                集群管理
                            </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="">
                        <a href="manager_cluster_settings.html">
                            <i class="menu-icon fa fa-angle-right"></i> 集群配置
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="">
                        <a href="manager_cluster_nodes.html">
                            <i class="menu-icon fa fa-angle-right"></i> 节点信息
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="">
                        <a href="manager_cluster_status.html">
                            <i class="menu-icon fa fa-angle-right"></i> 集群状态
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="active">
                        <a href="manager_cluster_machines.html">
                            <i class="menu-icon fa fa-angle-right"></i> 机器状态
                        </a>
                        <b class="arrow"></b>
                    </li>

                </ul>
            </li>

            <li class="">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-gavel"></i>
                    <span class="menu-text"> 集群监控 </span>

                    <b class="arrow fa fa-angle-down"></b>
                </a>

                <b class="arrow"></b>

                <ul class="submenu">
                    <li class="">
                        <a href="alarm_cluster_settings.html">
                            <i class="menu-icon fa fa-angle-right"></i>
                            报警设置
                        </a>

                        <b class="arrow"></b>
                    </li>

                </ul>
            </li>
            <li class="">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-cogs"></i>
                    <span class="menu-text"> 系统设置 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="">
                        <a href="system_cluster_about.html">
                            <i class="menu-icon fa fa-angle-right"></i> 关于
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>
            <li class="">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-graduation-cap"></i>
                    <span class="menu-text"> 文档学习 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="">
                        <a href="keeper_cluster_study.html">
                            <i class="menu-icon fa fa-angghnle-right"></i> ZooKeeper 分布式
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>
        </ul>
        <!-- /.nav-list -->
        <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
            <i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state"
               data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
        </div>
    </div>
    <div class="main-content">
        <div class="main-content-inner">
            <div class="page-content">
                <div class="row">
                    <div class="col-xs-12">
                        <!--<div class="hr hr32 hr-dotted"></div>-->
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="widget-box transparent">
                                    <div class="widget-header widget-header-flat"
                                         style="border-bottom: 0px solid #DCE8F1;">
                                        <h3 class="header smaller lighter black"><i
                                                class="ace-icon glyphicon glyphicon-align-justify"></i>&nbsp;机器状态
                                            &nbsp;&nbsp;
                                        </h3>
                                    </div>
                                    <div class="widget-body">
                                        <div class="row">
                                            <form class="form-horizontal" role="form">
                                                <div class="form-group">
                                                    <label class="col-sm-1 control-label no-padding-right"
                                                           for="clusterList"> 选择集群 </label>
                                                    <div class="col-sm-2">
                                                        <select class="chosen-select form-control clusterList"
                                                                id="clusterList"
                                                                data-placeholder="请选择...">
                                                            <option value=""></option>
                                                        </select>
                                                    </div>
                                                    <div class="col-sm-4">
                                                        <button class="btn btn-info btn-sm" type="button"
                                                                id="submitClusterID">
                                                            选择
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="hr hr-dotted hr-20"></div>
                                            </form>
                                        </div>
                                        <div class="row">


                                            <div class="col-sm-12">
                                                <div class="widget-box transparent">
                                                    <div class="widget-header widget-header-flat">
                                                        <h4 class="widget-title lighter">
                                                            <i class="ace-icon fa fa-sitemap"></i>
                                                            实时信息
                                                        </h4>
                                                    </div>

                                                    <div class="widget-body">
                                                        <div class="tabbable">
                                                            <ul class="nav nav-tabs" id="myTab">
                                                                <li v-for="status in clusterStatus" class=""
                                                                    :serverID="status.serverID">
                                                                    <a data-toggle="tab" href="#home" >
                                                                        <span v-if="status.mode == 'leader'">
                                                                            <i class="green ace-icon glyphicon glyphicon-flag bigger"></i>
                                                                        </span>
                                                                        {{status.host}}:{{status.port}}
                                                                    </a>
                                                                </li>
                                                            </ul>
                                                        </div>

                                                        <br>
                                                        <div class="row">


                                                            <div class="col-sm-6">
                                                                <div id="chart03"
                                                                     style="padding: 0px; position: relative;height: 450px">
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-6">
                                                                <div id="chart04"
                                                                     style="padding: 0px; position: relative;height: 450px">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <br><br>
                                                        <div class="row">


                                                            <div class="col-sm-6">
                                                                <div id="chart05"
                                                                     style="padding: 0px; position: relative;height: 450px">
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-6">
                                                                <div id="chart06"
                                                                     style="padding: 0px; position: relative;height: 450px">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <br><br>
                                                        <div class="row">


                                                            <div class="col-sm-6">
                                                                <div id="chart07"
                                                                     style="padding: 0px; position: relative;height: 450px">
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-6">
                                                                <div id="chart08"
                                                                     style="padding: 0px; position: relative;height: 450px">
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div><!-- /.widget-body -->
                                            </div><!-- /.widget-box -->
                                        </div>
                                    </div>

                                </div>
                                <!-- /.widget-box -->
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->
                        <div class="hr hr32 hr-dotted"></div>
                        <!-- PAGE CONTENT ENDS -->
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </div>
            <!-- /.page-content -->
        </div>
    </div>
    <!-- /.main-content -->
</div>
<!-- /.main-container -->
<!-- inline scripts related to this page -->
<script type="text/javascript">

    /**
     *  page global data
     */
    var PageGlobalData = {};


    jQuery(function ($) {

        /**
         *  charts
         */
        machine_status_charts.init();
        window.onresize = function () {
            var charts = machine_status_charts.getCharts();
            for (var i in charts) {
                charts[i].resize();
            }
        }

        /**
         *  vues
         */
        var tabClusterStatusVue = new Vue({
            el: '#myTab',
            data: {
                clusterStatus: []
            },
            methods: {
                setClustersData: function (data) {
                    this.clusterStatus.splice(0, this.clusterStatus.length);

                    var _self = this;

                    var params = {clusterID: PageGlobalData.clusterID}

                    $.get(ZOOKEEPER_WEB_ADMIN_CONFIG.domain + "/cluster/status/cluster", params).done(function (result) {

                        var clusterStatus = result.data;
                        _self.clusterStatus = clusterStatus;

                    }).fail(function (error) {

                        console.log(error)
                        $.scojs_message("发生错误, 稍后再试", $.scojs_message.TYPE_ERROR, 40000);
                    });


                }
            }
        })


        /**
         *  bind events
         */
        $('#submitClusterID').click(function () {
            PageGlobalData.clusterID = $(".chosen-select").val();
            tabClusterStatusVue.setClustersData()
        })


        $.post(ZOOKEEPER_WEB_ADMIN_CONFIG.domain + "/cluster/listZKClusters").done(function (resObj) {

            var dataz = resObj.data;
            for (var o in dataz) {
                $(".clusterList").append("<option value='" + dataz[o].clusterID + "'>" + dataz[o].clusterName + "</option>");
            }
            $('.chosen-select').chosen();

        }).fail(function (error) {

            console.log(error)
            try {
                var message = "操作失败";
                message = JSON.parse(error.responseText).error;
            } catch (e) {
                $.scojs_message(message, $.scojs_message.TYPE_ERROR, 40000);
            }
        })

    })
</script>
</body>

</html>